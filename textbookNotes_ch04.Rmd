---
title: "textbookNotes_ch04"
author: "Kristin Henderson"
date: "2025-08-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tswge)
```

1. The function sin 2(π ft) has frequency f. That is, it goes through f cycles per unit.  
2. If the data are collected annually, monthly, or hourly then the corresponding frequencies  measure the number of cycles per year, month, or hour, respectively.  
3. In scientific and engineering literature, it is common to measure frequency in Hertz (Hz), which  is the number of cycles per second. 

## Cyclic/Pseudo-periodic Data
```{r}
data(sunspot2.0)

data(lynx)
llynx=log10(lynx)

x3=gen.arma.wge(n=100,phi=c(1.75,-.95),sn=203)

par(mfrow=c(1,3),mar=c(4,3,.2,.5))
plotts.wge(sunspot2.0)
plotts.wge(llynx)
plotts.wge(x3) 
```

## Spectral Density

- The top left plot is the sum of the other 3 sine waves.
```{r}
t=1:100
y=rep(0,100)
y1=rep(0,100)
y2=rep(0,100)
y3=rep(0,100)
for(i in 1:100){y1[i]= 4*sin(2*pi*.04*i)}
for(i in 1:100){y2[i]=1.25*sin(2*pi*.125*i+1)}
for(i in 1:100){y3[i]=.5*sin(2*pi*.25*i+2.5)}
y=y1+y2+y3  
par(mfrow=c(2,2),mar=c(4,2.5,1.5,.5))
plot(y,type='l',xlab='(a) Linear Combination of Sines',ylim=c(-6,6))
plot(y1,type='l',xlab='(b) Component 1',ylim=c(-6,6))
plot(y2,type='l',xlab='(c) Component 2',ylim=c(-6,6))
plot(y3,type='l',xlab='(d) Component 3',ylim=c(-6,6)) 

```

## Nyquist Frequency

The definition of spectral density is subject to the constraint that $|f| \leq .5$.

If data are sampled at increments of $\Delta$, then the Nyquist frequency is $1/2\Delta$, and the shortest observable period is $2\Delta$.

```{r}
t=1:1000
tm=t/200
y1=sin(2*pi*.2*tm)
z1=sin(2*pi*1.2*tm)
tp=c(0,1,2,3,4,5)
yp=sin(2*pi*.2*tp)
par(mfrow=c(1,1),mar=c(2.5,2.5,1,1.5))
plot(tm,y1,type='l',xlab='Time',xlim=c(0,5))
points(tm,z1,type='l',lwd=2)
points(tp,yp,pch=19) 
```

## Frequency $f = 0$

1 Data associated with frequency f = 0 never have a repeating behavior and are characterized by  “aimless wandering” behavior.
2 Given a realization of length n that shows only “aimless wandering”, all we can confidently say is that if there is a repeating period in the data, the period length is longer than n. 

The shorter the period length, the higher the frequency.

In the plots below, the peak at f = .05 is associated with the previously mentioned period lengths of about 20. The  peak at f = .45 is associated with cycle lengths of approximately 1/.45 = 2.2 These short cycles are  associated with the “high frequency” wiggle in the data.
```{r}
x=plotts.true.wge(n=200,phi=c(0.1300,1.4414,-0.0326,-0.8865),sn=9310) 
```

## Sample Spectral Density

The sample spectral density does not “improve” as the realization length increases.  ̶ that is, it does not converge to the true spectral density as n increases.
```{r}
x=gen.arma.wge(n=200,phi=c(0.1300,1.4414,-0.0326,-0.8865),sn=9310)  #this generates an AR(4) realization (details in Chapter 5) 
par(mfrow=c(2,3))
plotts.wge(x)
abline(v=100)
sample.spec.wge(x[1:100])
sample.spec.wge(x) # for a realization of length n, this command returns the sample spectral density
parzen.wge(x)
parzen.wge(x,trunc=8)
parzen.wge(x,trunc=175) 
```

## Smoothing the Sample Spectral Density
```{r}
x=gen.arma.wge(n=200,phi=c(0.1300,1.4414,-0.0326,-0.8865),sn=9310)
parzen.wge(x)
parzen.wge(x, trunc = 8)
parzen.wge(x, trunc = 50)

plotts.sample.wge(x)
```

## Parzen spectral density estimate

Higher peaks tend to indicate more promine nt behavior at the associated frequency. 
```{r}
y1=rep(0,100)
y2=rep(0,100)
y3=rep(0,100)
y=rep(0,100)
for(t in 1:100){y1[t]= 4*sin(2*pi*.04*t)}
for(t in 1:100){y2[t]=1.25*sin(2*pi*.125*t+1)}
for(t in 1:100){y3[t]=.5*sin(2*pi*.25*t+2.5)}
y=y1+y2+y3
par(mfrow=c(1,3))
plotts.wge(y)
parzen.wge(y,trunc=20)
parzen.wge(y,trunc=30) 
```

## Cyclic/periodic data with cycle lengths of 11 and 10, respectively. Both have peaks at ~.1. Sunspot day also has a peak at $f = 0$ consistent with some longer cyclic or wandering behavior.
```{r}
data(sunspot2.0)
plotts.sample.wge(sunspot2.0)

data(llynx)
plotts.sample.wge(llynx)
```

## Aperiodic data with wandering behavior
```{r}
data(wtcrude2020)
plotts.sample.wge(wtcrude2020)
```

## Filtering

1. Low-pass filters pass through lower frequencies and remove higher frequencies  ̶ low-pass filtered data have a smoother appearance than the original data  ̶ a centered moving average smoother is an example of a low-pass filter
2. High-pass filters pass through higher frequencies and remove lower frequencies  ̶ high-pass filtered data have a noisy/high-frequency appearance  ̶ a difference is an example of a high-pass filter  ̶ high-pass filters are often used to remove low-frequency noise, eliminate humming sounds in audio signals, and so forth
3. Band-pass filters pass through behavior in a certain band (or range) of frequencies.
4. Band-stop filters remove behavior in a particular band of frequencies and retain the frequencies outside this band. 

Here the center plot is an example of a centered moving average smoother, which is a low-pass filter, and the right-hand plot is the first difference, which is a high-pass filter.
```{r}
#Note: This code is for WT Crude from Jan 1990 through December 2020
data(wtcrude2020)
n=length(wtcrude2020)
parz.wt=parzen.wge(wtcrude2020,plot=FALSE)
s9=ma.smooth.wge(wtcrude2020,order=9,plot=FALSE)
parz.s9=parzen.wge(s9$smooth[5:114],plot=FALSE)
d1.wt=rep(NA,n)
for(t in 2:n) d1.wt[t-1]=wtcrude2020[t]-wtcrude2020[t-1]
parz.d1=parzen.wge(d1.wt[1:n-1],plot=FALSE)
par(mfrow=c(1,3),mar=c(4.5,3,2,.5))
plot(wtcrude2020,type='l',xlab='(a) WT Crude Oil Price')
plot(s9$smooth,type='l',xlab='(b) WT Crude Smoothed')
plot(d1.wt,type='l',xlab='(c) WR Crude Differenced data',ylim=c(-50,50)) 
```

The second row of plots show the smoothed data after appying a 6th-order centered moving average smoother. The third row is the differenced data that shows the dominant peak at $f = 0.45$
```{r}
x=gen.arma.wge(n=200,phi=c(0.1300,1.4414,-0.0326,-0.8865),sn=9310)
n=length(x)
par(mfrow=c(3,2),mar=c(3,2.5,1,1.5))
plot(x,type='l',ylim=c(-20,20))
parzen.wge(x)
s6=ma.smooth.wge(x,order=6,plot=FALSE)
plot(s6$smooth,type='l',ylim=c(-20,20))
parzen.wge(s6$smooth[4:197])
d1 = numeric(n-1)   # create empty vector of length n-1
for(t in 2:n)
  d1[t-1]=x[t]-x[t-1]
plot(d1,type='l',ylim=c(-20,20))
parzen.wge(d1[1:n-1]) 
```

## Butterworth Filter

1. The Butterworth filter can be “fine-tuned” to retain and remove certain frequencies.
2. Through use of the cutoff frequency, the Butterworth filter can be designed to remove (or retain)  specified frequency ranges.     ̶ the centered moving average smoother and the difference do not have this type of “frequency  control”
3. The Butterworth filter has “end-effects” issues. The tswge function butterworth.wge does not control for these, so data values toward
   -̶ The larger the filter order, the more values are subject to end-effects problems.
    ̶ This is like the centered moving average filter, which cannot be applied to ends of the data.
    ̶ The number of undefined values increases as the order increases. 
4. The Butterworth filter (either low-pass or high-pass) can be best implemented by understanding the frequency behavior in the original data. 
```{r}
x=gen.arma.wge(n=200,phi=c(0.1300,1.4414,-0.0326,-0.8865),sn=9310)
par(mfrow=c(3,2),mar=c(3,2.5,1,1.5))
plot(x,type='l',ylim=c(-20,20))
parzen.wge(x)
low=butterworth.wge(x,type='l',cutoff=.25,plot=FALSE)
plot(low$x.filt,type='l',ylim=c(-20,20))
parzen.wge(low$x.filt)
high=butterworth.wge(x,type='h',cutoff=.25,plot=FALSE)
plot(high$x.filt,type='l',ylim=c(-20,20))
parzen.wge(high$x.filt) 
```

